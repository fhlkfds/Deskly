{% extends "base.html" %}

{% block title %}Credential Management - School Inventory System{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <h2><i class="bi bi-key"></i> Credential Management</h2>
        <p class="text-muted mb-0">Manage Drive and AuditLog destinations for snapshot storage.</p>
    </div>
</div>

<div class="card mb-4">
    <div class="card-header">
        <h5 class="mb-0">Credential Management</h5>
    </div>
    <div class="card-body">
        <form method="POST" action="{{ url_for('settings.update_credential_management') }}">
            <h6 class="mb-3">Audit Snapshot Storage</h6>
            <div class="row g-3 mb-3">
                <div class="col-md-4">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="audit_drive_enabled" name="audit_drive_enabled"
                               {% if audit_drive_enabled %}checked{% endif %}>
                        <label class="form-check-label" for="audit_drive_enabled">Upload snapshots to Google Drive</label>
                    </div>
                </div>
                <div class="col-md-8">
                    <label for="audit_drive_credentials_file" class="form-label">Drive Credentials File</label>
                    <input type="text" class="form-control" id="audit_drive_credentials_file" name="audit_drive_credentials_file"
                           value="{{ audit_drive_credentials_file }}" placeholder="credentials.json">
                </div>
                <div class="col-md-8">
                    <label for="audit_drive_folder_id" class="form-label">Drive Folder ID (optional)</label>
                    <input type="text" class="form-control" id="audit_drive_folder_id" name="audit_drive_folder_id"
                           value="{{ audit_drive_folder_id }}" placeholder="1a2b3c...">
                </div>
                <div class="col-md-4">
                    <div class="form-check form-switch mt-4">
                        <input class="form-check-input" type="checkbox" id="audit_local_output_enabled" name="audit_local_output_enabled"
                               {% if audit_local_output_enabled %}checked{% endif %}>
                        <label class="form-check-label" for="audit_local_output_enabled">Save snapshots locally</label>
                    </div>
                </div>
                <div class="col-md-8">
                    <label for="audit_local_output_dir" class="form-label">Local Snapshot Directory</label>
                    <input type="text" class="form-control" id="audit_local_output_dir" name="audit_local_output_dir"
                           value="{{ audit_local_output_dir }}" placeholder="audit_snapshots">
                </div>
            </div>

            <h6 class="mb-3">Audit Log Hash Chain</h6>
            <div class="row g-3 mb-3">
                <div class="col-md-4">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="audit_log_sheet_enabled" name="audit_log_sheet_enabled"
                               {% if audit_log_sheet_enabled %}checked{% endif %}>
                        <label class="form-check-label" for="audit_log_sheet_enabled">Write to Google Sheet</label>
                    </div>
                </div>
                <div class="col-md-8">
                    <label for="audit_log_sheet_credentials_file" class="form-label">Sheet Credentials File</label>
                    <input type="text" class="form-control" id="audit_log_sheet_credentials_file" name="audit_log_sheet_credentials_file"
                           value="{{ audit_log_sheet_credentials_file }}" placeholder="credentials.json">
                </div>
                <div class="col-md-6">
                    <label for="audit_log_sheet_id" class="form-label">Sheet ID</label>
                    <input type="text" class="form-control" id="audit_log_sheet_id" name="audit_log_sheet_id"
                           value="{{ audit_log_sheet_id }}" placeholder="Google Sheet ID">
                </div>
                <div class="col-md-6">
                    <label for="audit_log_sheet_tab" class="form-label">Sheet Tab Name</label>
                    <input type="text" class="form-control" id="audit_log_sheet_tab" name="audit_log_sheet_tab"
                           value="{{ audit_log_sheet_tab }}" placeholder="AuditLog">
                </div>
                <div class="col-md-4">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="audit_log_local_enabled" name="audit_log_local_enabled"
                               {% if audit_log_local_enabled %}checked{% endif %}>
                        <label class="form-check-label" for="audit_log_local_enabled">Write to local log</label>
                    </div>
                </div>
                <div class="col-md-8">
                    <label for="audit_log_local_path" class="form-label">Local Log File</label>
                    <input type="text" class="form-control" id="audit_log_local_path" name="audit_log_local_path"
                           value="{{ audit_log_local_path }}" placeholder="audit_logs/audit_log.csv">
                </div>
            </div>

            <h6 class="mb-3">Documentation Backup</h6>
            <div class="row g-3 mb-3">
                <div class="col-md-4">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="docs_drive_enabled" name="docs_drive_enabled"
                               {% if docs_drive_enabled %}checked{% endif %}>
                        <label class="form-check-label" for="docs_drive_enabled">Upload documentation backup to Drive</label>
                    </div>
                </div>
                <div class="col-md-8">
                    <label for="docs_drive_credentials_file" class="form-label">Drive Credentials File</label>
                    <input type="text" class="form-control" id="docs_drive_credentials_file"
                           value="{{ docs_drive_credentials_file }}" placeholder="credentials.json" disabled>
                    <div class="form-text">Set in <code>.env</code> as <code>DOCS_DRIVE_CREDENTIALS_FILE</code>.</div>
                </div>
                <div class="col-md-8">
                    <label for="docs_drive_folder_id" class="form-label">Drive Folder ID (optional)</label>
                    <input type="text" class="form-control" id="docs_drive_folder_id"
                           value="{{ docs_drive_folder_id }}" placeholder="1a2b3c..." disabled>
                    <div class="form-text">Set in <code>.env</code> as <code>DOCS_DRIVE_FOLDER_ID</code>.</div>
                </div>
            </div>

            <button type="submit" class="btn btn-primary">
                <i class="bi bi-save"></i> Save Credential Settings
            </button>
        </form>
    </div>
</div>
{% endblock %}
